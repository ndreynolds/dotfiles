#!/usr/bin/env bash 
# TODO: add cases for non-debian linux

### Detect platform

platform='unknown'
uname=$(uname)

if [[ $uname == 'Linux' ]]; then
    platform='linux'
    debian=false
    if which apt-get > /dev/null; then
        debian=true
    fi

elif [[ $uname == 'Darwin' ]]; then
    platform='darwin'

fi


### Setup home directory

cd ~
mkdir repos
mkdir venvs
mkdir trackers


### Platform-dependent tool installs

# curl if Debian
if [[ $platform == 'linux' && $debian ]]; then
    sudo apt-get install curl
fi

# homebrew if Mac
if [[ $platform == 'darwin' ]]; then
    /usr/bin/ruby -e "$(curl -fsSL https://raw.github.com/gist/323731)"
fi

# git and git-flow
if [[ $platform == 'linux' && $debian ]]; then
    sudo apt-get install git-core
    wget --no-check-certificate -q -O - https://github.com/nvie/gitflow/raw/develop/contrib/gitflow-installer.sh | sudo bash
elif [[ $platform == 'darwin' ]]; then
    brew install git
    brew install git-flow
fi

# python dev and setuptools if Debian
if [[ $platform == 'linux' && $debian ]]; then
    sudo apt-get install python-dev
    sudo apt-get install python-setuptools
fi

# pip and virtualenv
sudo easy_install pip
sudo pip install virtualenv

# tmux 
if [[ $platform == 'linux' && $debian ]]; then
    sudo apt-get install tmux
elif [[ $platform == 'darwin' ]]; then
    brew install tmux
fi

# Vim if Debian
if [[ $platform == 'linux' && $debian ]]; then
    sudo apt-get install vim
fi

# MacVim if Darwin
if [[ $platform == 'darwin' ]]; then
    brew install macvim
fi

# ruby if Debian
if [[ $platform == 'linux' && $debian ]]; then
    sudo apt-get install ruby
fi

# node and npm
if [[ $platform == 'linux' && $debian ]]; then
    # build node from scratch
    git clone --depth 1 git://github.com/joyent/node.git
    cd node
    git checkout v0.4.12
    ./configure
    make -j2
    sudo make install
    # get npm
    curl http://npmjs.org/install.sh | sh
elif [[ $platform == 'darwin' ]]; then
    # node
    brew install node
    # npm
    curl http://npmjs.org/install.sh | sh
fi

# coffee and less
npm install -U coffeescript
npm install -U lesscss
    

### Get and unpack dotfiles

cd ~
git clone --recursive git@ndreynolds.com:dotfiles.git
cd dotfiles
# run the link script to create symlinks in $HOME
./bin/link --quiet
# add ~/dotfiles/bin to the end of $PATH
echo "export PATH=$PATH:$HOME/dotfiles/bin" >> ~/.profile
